# J15 Backend - åˆå­¦è€…å‘ã‘é–‹ç™ºã‚¬ã‚¤ãƒ‰

## ğŸ“š ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è§£èª¬](#2-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è§£èª¬)
3. [ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¥é–€](#3-ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¥é–€)
4. [ä¸»è¦æ©Ÿèƒ½ã®ä»•çµ„ã¿](#4-ä¸»è¦æ©Ÿèƒ½ã®ä»•çµ„ã¿)
5. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#5-é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
6. [ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#6-ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
7. [ã‚ˆãã‚ã‚‹è³ªå• (FAQ)](#7-ã‚ˆãã‚ã‚‹è³ªå•-faq)
8. [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#8-æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä½•ã‚’ã™ã‚‹ã‚‚ã®ï¼Ÿ

**J15 Backend**ã¯ã€å­¦ç¿’ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã§ã™ã€‚ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ï¼š

- ğŸ“– **é¡Œæç®¡ç†**: å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç™»éŒ²ãƒ»ç®¡ç†
- ğŸ“ **ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†**: å„é¡Œæã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ç®¡ç†
- ğŸ“Š **é€²æ—ç®¡ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å­¦ç¿’é€²æ—ã‚’è¨˜éŒ²
- ğŸ” **èªè¨¼æ©Ÿèƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
- ğŸ–¼ï¸ **ç”»åƒç®¡ç†**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é–¢é€£ã™ã‚‹ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### èª°ãŒä½¿ã†ã®ï¼Ÿ

1. **ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼**: å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é–²è¦§ã€é€²æ—è¨˜éŒ²
2. **ç®¡ç†è€…**: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è§£èª¬

### 2.1 Kotlin ã£ã¦ä½•ï¼Ÿ

**Kotlin**ã¯ã€Javaã®å¾Œç¶™ã¨ã—ã¦é–‹ç™ºã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã™ã€‚

**ç‰¹å¾´**:
- âœ… **ç°¡æ½”**: Javaã‚ˆã‚Šå°‘ãªã„ã‚³ãƒ¼ãƒ‰ã§åŒã˜ã“ã¨ãŒã§ãã‚‹
- âœ… **å®‰å…¨**: Nullå®‰å…¨æ€§ã§ãƒã‚°ã‚’æ¸›ã‚‰ã›ã‚‹
- âœ… **Javaäº’æ›**: Javaã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãã®ã¾ã¾ä½¿ãˆã‚‹

**ä¾‹: Javaã¨ã®æ¯”è¼ƒ**
```kotlin
// Kotlin (ã‚·ãƒ³ãƒ—ãƒ«ï¼)
data class User(val name: String, val age: Int)

// Java (å†—é•·...)
public class User {
    private final String name;
    private final int age;

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() { return name; }
    public int getAge() { return age; }
    // equals, hashCode, toString ã‚‚å¿…è¦...
}
```

### 2.2 Spring Boot ã£ã¦ä½•ï¼Ÿ

**Spring Boot**ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡å˜ã«ä½œã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

**ä½•ãŒã§ãã‚‹ï¼Ÿ**:
- ğŸŒ **Web APIä½œæˆ**: RESTful APIã‚’ç°¡å˜ã«å®Ÿè£…
- ğŸ’¾ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº**: SQLã‚’æ›¸ã‹ãªãã¦ã‚‚DBæ“ä½œã§ãã‚‹
- ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: èªè¨¼ãƒ»èªå¯ã®ä»•çµ„ã¿ãŒçµ„ã¿è¾¼ã¿æ¸ˆã¿

**ä¾‹: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½œæˆ**
```kotlin
@RestController
@RequestMapping("/api/health")
class HealthCheckController {

    @GetMapping
    fun health(): Map<String, String> {
        return mapOf("status" to "OK")
    }
}
```
ã“ã‚Œã ã‘ã§ `GET /api/health` ã¨ã„ã†APIãŒã§ãã¾ã™ï¼

### 2.3 PostgreSQL ã£ã¦ä½•ï¼Ÿ

**PostgreSQL**ã¯ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆRDBï¼‰ã®ä¸€ç¨®ã§ã™ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜æ–¹æ³•**:
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_id â”‚ username â”‚ email          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 001     â”‚ tanaka   â”‚ tanaka@ex.com  â”‚
â”‚ 002     â”‚ suzuki   â”‚ suzuki@ex.com  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¥é–€

### 3.1 ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ï¼Ÿ

ã‚³ãƒ¼ãƒ‰ã‚’**ç‰ã­ãã®å±¤**ã®ã‚ˆã†ã«åˆ†ã‘ã¦æ•´ç†ã™ã‚‹è¨­è¨ˆæ–¹æ³•ã§ã™ã€‚

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Presentation (å¤–å´)       â”‚  â† API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ Infrastructure      â”‚    â”‚  â† ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€å¤–éƒ¨API
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
        â”‚  â”‚  â”‚ Application â”‚    â”‚    â”‚  â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
        â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚    â”‚
        â”‚  â”‚  â”‚  â”‚ Domainâ”‚  â”‚    â”‚    â”‚  â† ä¸­å¿ƒ: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
        â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚    â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å„å±¤ã®å½¹å‰²

#### ğŸ¯ Domainå±¤ (ä¸­å¿ƒ)
**å½¹å‰²**: ãƒ“ã‚¸ãƒã‚¹ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©
**ä¾‹**: ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯é‡è¤‡ç¦æ­¢ã€

```kotlin
// src/main/kotlin/com/j15/backend/domain/model/user/User.kt
data class User(
    val userId: UserId,
    val username: Username,
    val email: Email,  // â† Emailå‹ã§å®‰å…¨æ€§ã‚’ä¿è¨¼
    val passwordHash: PasswordHash,
    val role: UserRole = UserRole.ROLE_USER
)
```

#### âš™ï¸ Applicationå±¤
**å½¹å‰²**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
**ä¾‹**: ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€

```kotlin
// src/main/kotlin/com/j15/backend/application/usecase/auth/AuthUseCase.kt
fun authenticate(email: String, plainPassword: String): AuthenticationResult {
    val user = userRepository.findByEmail(Email(email))
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ã€ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ...
}
```

#### ğŸ—„ï¸ Infrastructureå±¤
**å½¹å‰²**: å¤–éƒ¨ã¨ã®ã‚„ã‚Šå–ã‚Šï¼ˆDBã€AWS S3ãªã©ï¼‰
**ä¾‹**: ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜å‡¦ç†ã€

```kotlin
// src/main/kotlin/com/j15/backend/infrastructure/persistence/repository/UserRepositoryImpl.kt
@Repository
class UserRepositoryImpl(
    private val jpaRepository: JpaUserRepository
) : UserRepository {
    override fun save(user: User): User {
        val entity = UserConverter.toEntity(user)
        val saved = jpaRepository.save(entity)
        return UserConverter.toDomain(saved)
    }
}
```

#### ğŸŒ Presentationå±¤
**å½¹å‰²**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®šç¾©
**ä¾‹**: ã€ŒPOST /api/auth/signinã€

```kotlin
// src/main/kotlin/com/j15/backend/presentation/controller/auth/AuthController.kt
@PostMapping("/signin")
fun signIn(@RequestBody request: LoginRequest): ResponseEntity<LoginResponse> {
    val result = authUseCase.authenticate(request.email, request.password)
    return ResponseEntity.ok(LoginResponse(result.tokens))
}
```

### 3.3 ãªãœã“ã®æ§‹é€ ï¼Ÿ

**ãƒ¡ãƒªãƒƒãƒˆ**:
1. âœ… **å¤‰æ›´ã«å¼·ã„**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å¤‰ãˆã¦ã‚‚ã€Domainå±¤ã¯å¤‰æ›´ä¸è¦
2. âœ… **ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„**: å„å±¤ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹
3. âœ… **ç†è§£ã—ã‚„ã™ã„**: è²¬ä»»ãŒæ˜ç¢ºã«åˆ†ã‹ã‚Œã¦ã„ã‚‹

---

## 4. ä¸»è¦æ©Ÿèƒ½ã®ä»•çµ„ã¿

### 4.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant C as Controller
    participant A as AuthUseCase
    participant R as Repository
    participant DB as Database

    U->>C: POST /api/auth/signin<br/>{email, password}
    C->>A: authenticate(email, password)
    A->>R: findByEmail(email)
    R->>DB: SELECT * FROM users...
    DB-->>R: UserEntity
    R-->>A: User
    A->>A: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
    A->>A: JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    A-->>C: AuthenticationResult
    C-->>U: LoginResponse<br/>{accessToken, refreshToken}
```

**ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬**:
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡
2. **Controller**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€UseCaseã«å§”è­²
3. **UseCase**:
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ï¼ˆBCryptï¼‰
   - JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
4. **Repository**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
5. **Response**: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”å´

### 4.2 é€²æ—ç®¡ç†ãƒ•ãƒ­ãƒ¼

**ã‚·ãƒŠãƒªã‚ª**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚»ã‚¯ã‚·ãƒ§ãƒ³1ã‚’å®Œäº†ãƒãƒ¼ã‚¯

```kotlin
// 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
POST /api/progress/subjects/1/sections
{
  "sectionId": 1
}

// 2. UseCaseã§ã®å‡¦ç†
fun markSectionAsCleared(
    userId: UserId,
    subjectId: SubjectId,
    sectionId: SectionId
): UserClearedSection {
    // â‘  é¡Œæã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å­˜åœ¨ç¢ºèª
    val subject = subjectRepository.findById(subjectId)
        ?: throw IllegalArgumentException("é¡ŒæãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")

    sectionRepository.findById(subjectId, sectionId)
        ?: throw IllegalArgumentException("ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")

    // â‘¡ é€²æ—æƒ…å ±ã®ä½œæˆ
    val userProgress = getUserProgress(userId, subjectId)
    val cleared = userProgress.markSectionAsCleared(sectionId)

    // â‘¢ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    return clearedSectionRepository.save(cleared)
}

// 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜
INSERT INTO user_cleared_sections
    (user_id, subject_id, section_id, completed_at)
VALUES
    ('uuid', 1, 1, '2025-12-21 10:00:00');
```

### 4.3 JWTèªè¨¼ã®ä»•çµ„ã¿

**JWT (JSON Web Token)**: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’è¡Œã†ä»•çµ„ã¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JWT Token ã®æ§‹é€                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Header    â”‚ Payload         â”‚ Signature         â”‚
â”‚ (æš—å·åŒ–æ–¹å¼) â”‚ (ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±)    â”‚ (æ”¹ã–ã‚“é˜²æ­¢)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {"alg":   â”‚ {"userId":      â”‚ HMACSHA256(       â”‚
â”‚  "HS256"} â”‚  "abc-123",     â”‚   base64(header)  â”‚
â”‚           â”‚  "role":        â”‚   + "." +         â”‚
â”‚           â”‚  "ROLE_USER"}   â”‚   base64(payload),â”‚
â”‚           â”‚                 â”‚   secret)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**èªè¨¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‹•ä½œ**:
```kotlin
// src/main/kotlin/com/j15/backend/infrastructure/security/JwtAuthenticationFilter.kt
override fun doFilterInternal(request, response, filterChain) {
    try {
        // â‘  Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³æŠ½å‡º
        val token = extractTokenFromRequest(request)

        // â‘¡ ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼
        if (token != null && jwtTokenService.validateToken(token)) {
            // â‘¢ ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
            val userId = jwtTokenService.getUserIdFromToken(token)
            val role = jwtTokenService.getRoleFromToken(token)

            // â‘£ Spring Securityã®Contextã«èªè¨¼æƒ…å ±ã‚’è¨­å®š
            val authentication = UsernamePasswordAuthenticationToken(
                userId, null, listOf(SimpleGrantedAuthority(role.name))
            )
            SecurityContextHolder.getContext().authentication = authentication
        }
    } catch (e: Exception) {
        // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›ã€Contextã¯ç©ºã®ã¾ã¾
    }

    // â‘¤ æ¬¡ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¸
    filterChain.doFilter(request, response)
}
```

---

## 5. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 5.1 å¿…è¦ãªãƒ„ãƒ¼ãƒ«

| ãƒ„ãƒ¼ãƒ« | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|--------|-----------|------|
| Java | 17ä»¥ä¸Š | Kotlinã®å®Ÿè¡Œç’°å¢ƒ |
| Docker | æœ€æ–°ç‰ˆ | PostgreSQLèµ·å‹• |
| Git | æœ€æ–°ç‰ˆ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† |

### 5.2 ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
```bash
git clone https://github.com/J15team/Backend.git
cd backend
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: Docker Composeã§èµ·å‹•
```bash
# PostgreSQLã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: å‹•ä½œç¢ºèª
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8080/api/health

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{"status":"OK"}
```

### 5.3 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®æµã‚Œ

```bash
# 1. ã‚³ãƒ¼ãƒ‰å¤‰æ›´å¾Œã€ãƒ“ãƒ«ãƒ‰ç¢ºèª
./gradlew build

# 2. Dockerç’°å¢ƒã§å‹•ä½œãƒ†ã‚¹ãƒˆ
docker-compose up -d

# 3. APIãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:8080/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'
```

---

## 6. ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 6.1 å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

**ãªãœä½¿ã†ï¼Ÿ**: å‹å®‰å…¨æ€§ã‚’é«˜ã‚ã€ãƒã‚°ã‚’é˜²ã

**æ‚ªã„ä¾‹**:
```kotlin
// âŒ Stringå‹ã§æ··ä¹±ã®å…ƒ
fun createUser(userId: String, username: String, email: String)

// ã©ã‚ŒãŒã©ã‚Œï¼Ÿé–“é•ãˆã‚„ã™ã„ï¼
createUser("tanaka", "123e4567", "tanaka@example.com")
```

**è‰¯ã„ä¾‹**:
```kotlin
// âœ… å‹ã§åŒºåˆ¥ã§ãã‚‹
data class UserId(val value: UUID)
data class Username(val value: String)
data class Email(val value: String)

fun createUser(userId: UserId, username: Username, email: Email)

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒãƒã‚§ãƒƒã‚¯ã—ã¦ãã‚Œã‚‹
createUser(
    UserId(UUID.randomUUID()),
    Username("tanaka"),
    Email("tanaka@example.com")
)
```

### 6.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼**:
```kotlin
// UseCaseå±¤ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
fun updateSubject(subjectId: Long, title: String, maxSections: Int): Subject {
    // â‘  å…¥åŠ›å€¤æ¤œè¨¼
    require(maxSections in 1..1000) {
        "æœ€å¤§ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°ã¯1ä»¥ä¸Š1000ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"
    }

    // â‘¡ å­˜åœ¨ç¢ºèª
    val existing = subjectRepository.findById(SubjectId(subjectId))
        ?: throw IllegalArgumentException("é¡ŒæãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $subjectId")

    // â‘¢ æ›´æ–°å‡¦ç†
    return subjectRepository.save(existing.copy(title = title))
}
```

**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼**:
```kotlin
@RestControllerAdvice
class GlobalExceptionHandler {

    @ExceptionHandler(IllegalArgumentException::class)
    fun handleIllegalArgumentException(ex: IllegalArgumentException): ResponseEntity<ErrorResponse> {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST)
            .body(ErrorResponse(
                message = ex.message ?: "ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™",
                status = 400
            ))
    }
}
```

### 6.3 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†

**èª­ã¿å–ã‚Šå°‚ç”¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**:
```kotlin
@Transactional(readOnly = true)  // â† ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
fun getAllSubjects(): List<Subject> {
    return subjectRepository.findAll()
}
```

**æ›¸ãè¾¼ã¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**:
```kotlin
@Transactional  // â† è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
fun createSubject(subjectId: Long, title: String): Subject {
    val subject = Subject(SubjectId(subjectId), title)
    return subjectRepository.save(subject)
    // ä¾‹å¤–ç™ºç”Ÿæ™‚ã¯è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
}
```

### 6.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–
```kotlin
// âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„
val password = "password123"  // å¹³æ–‡ã§ä¿å­˜

// âœ… BCryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
val passwordEncoder = BCryptPasswordEncoder()
val hashedPassword = passwordEncoder.encode("password123")
// â†’ "$2a$10$N9qo8uLOickgx2ZMRZoMye..."
```

#### ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã®é˜²æ­¢
```kotlin
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚å‡¦ç†æ™‚é–“ã‚’ä¸€å®šã«ä¿ã¤
fun authenticate(email: String, plainPassword: String): AuthenticationResult {
    val user = userRepository.findByEmail(Email(email))

    val targetHash = user?.passwordHash?.value ?: dummyHash

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å­˜åœ¨ã«é–¢ã‚ã‚‰ãšã€å¿…ãšãƒãƒƒã‚·ãƒ¥æ¤œè¨¼ã‚’å®Ÿè¡Œ
    val isValid = passwordHashService.matches(plainPassword, targetHash)

    if (user == null || !isValid) {
        throw SecurityException("èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ")
    }

    return AuthenticationResult(user, generateTokens(user))
}
```

---

## 7. ã‚ˆãã‚ã‚‹è³ªå• (FAQ)

### Q1: ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ¡ãƒªãƒƒãƒˆã¯ï¼Ÿ
**A**:
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆDomainå±¤ï¼‰ãŒå¤–éƒ¨æŠ€è¡“ã«ä¾å­˜ã—ãªã„
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¤‰æ›´ã—ã¦ã‚‚ä¸­å¿ƒéƒ¨ã¯å¤‰æ›´ä¸è¦
- å±¤ã”ã¨ã«ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹

### Q2: data class ã£ã¦ä½•ãŒä¾¿åˆ©ãªã®ï¼Ÿ
**A**:
```kotlin
data class User(val name: String, val age: Int)

// è‡ªå‹•çš„ã«ä»¥ä¸‹ãŒç”Ÿæˆã•ã‚Œã‚‹
// - equals() / hashCode()
// - toString()
// - copy() ãƒ¡ã‚½ãƒƒãƒ‰
val user1 = User("tanaka", 25)
val user2 = user1.copy(age = 26)  // ä¸€éƒ¨ã ã‘å¤‰æ›´
```

### Q3: JWTèªè¨¼ã¯ã©ã“ã§ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ
**A**:
- `/api/progress/**` â†’ èªè¨¼å¿…é ˆ
- `/api/subjects` (GET) â†’ èªè¨¼ä¸è¦
- `/api/subjects` (POST/PUT/DELETE) â†’ ç®¡ç†è€…æ¨©é™å¿…é ˆ

### Q4: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã£ã¦ä½•ï¼Ÿ
**A**:
åŒä¸€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰å¤§é‡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ã‚‹ã®ã‚’é˜²ãä»•çµ„ã¿ã€‚
- åˆ¶é™: 60ç§’ã‚ãŸã‚Š100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- è¶…éæ™‚: HTTP 429ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™

---

## 8. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### åˆå¿ƒè€…å‘ã‘ã‚¿ã‚¹ã‚¯
1. âœ… Dockerç’°å¢ƒã§å‹•ä½œç¢ºèª
2. âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯APIã®å®Ÿè£…ã‚’èª­ã‚€
3. âœ… é¡Œæä¸€è¦§å–å¾—APIã®å‹•ä½œã‚’ç¢ºèª
4. ğŸ”„ ã‚·ãƒ³ãƒ—ãƒ«ãªAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ã¿ã‚‹

### ä¸­ç´šè€…å‘ã‘ã‚¿ã‚¹ã‚¯
1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®è¿½åŠ 
2. æ–°ã—ã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ï¼ˆN+1å•é¡Œã®è§£æ¶ˆï¼‰

### å‚è€ƒãƒªã‚½ãƒ¼ã‚¹
- [Kotlinå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://kotlinlang.org/docs/home.html)
- [Spring Bootå…¬å¼ã‚¬ã‚¤ãƒ‰](https://spring.io/guides)
- [ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è§£èª¬](https://jeffreypalermo.com/2008/07/the-onion-architecture-part-1/)

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-12-21
