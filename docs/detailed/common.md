# 共通仕様・エラーレスポンス

## 共通仕様

### レスポンス形式

すべてのレスポンスは JSON 形式です。

### 日時形式

ISO 8601 形式（UTC）を使用します。

```
例: "2025-12-06T10:00:00Z"
```

### HTTP ステータスコード

| コード | 説明                         |
| ------ | ---------------------------- |
| 200    | 成功（取得・更新・削除）     |
| 201    | 成功（作成）                 |
| 204    | 成功（レスポンスボディなし） |
| 400    | リクエストが不正             |
| 401    | 認証が必要                   |
| 403    | アクセス権限なし             |
| 404    | リソースが見つからない       |
| 409    | リソースの競合（重複など）   |
| 500    | サーバーエラー               |

---

## エラーレスポンス

### 共通エラー形式

エラーレスポンスは以下の形式で返されます。

```json
{
  "error": "エラーメッセージ"
}
```

または詳細がある場合：

```json
{
  "error": "Validation failed",
  "details": [
    "Username must be between 3 and 50 characters",
    "Password must be at least 8 characters"
  ]
}
```

### HTTP ステータスコードとエラー内容

| ステータスコード          | 説明                   | よくある原因                     |
| ------------------------- | ---------------------- | -------------------------------- |
| 400 Bad Request           | リクエストが不正       | バリデーションエラー、重複操作   |
| 404 Not Found             | リソースが見つからない | 存在しない ID、削除済みリソース  |
| 409 Conflict              | リソースの競合         | メールアドレス重複、題材 ID 重複 |
| 500 Internal Server Error | サーバーエラー         | 予期しないエラー                 |

---

## 補足情報

### 進捗率計算について

- **計算式**: `(完了セクション数 × 100) ÷ 題材の最大セクション数`
- **小数点処理**: 切り捨て（0~99 の範囲）
- **全完了時**: 必ず 100%を返す
- **例**: 16 セクション完了、最大 101 セクション → `(16 × 100) ÷ 101 = 15%`

### セクション ID の範囲

- **最小**: 0
- **最大**: 100
- 各題材は 0 から始まる連番である必要はありません
- フロントエンド側で任意のセクション ID を使用可能

### 題材とセクションの関係

```
Subject (題材)
  ├── maxSections: 101 (この題材の最大セクション数)
  └── Sections (セクション一覧)
      ├── Section 0
      ├── Section 1
      ├── Section 2
      └── ...
```

- 各題材は独立したセクション群を持つ
- セクション ID は題材内でのみ一意
- 異なる題材で同じセクション ID を使用可能

